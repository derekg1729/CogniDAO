-- Canonical Dolt schema for CogniMemorySystem-POC
-- This file should ideally be generated by experiments/scripts/generate_dolt_schema.py
-- based on the Pydantic models in experiments/src/memory_system/schemas/.
-- For now, it represents the schema created during Phase 1 tasks.

CREATE TABLE memory_blocks (
  id VARCHAR(255) PRIMARY KEY, -- Using VARCHAR based on Task 1.4 findings
  type TEXT NOT NULL CHECK (type IN ('knowledge', 'task', 'project', 'doc')),
  text TEXT NOT NULL,
  tags_json JSON,          -- Stores MemoryBlock.tags
  metadata_json JSON,      -- Stores MemoryBlock.metadata
  confidence_json JSON,    -- Stores MemoryBlock.confidence
  source_file TEXT,
  source_uri TEXT,
  created_by TEXT,
  created_at DATETIME,
  updated_at DATETIME
);

CREATE TABLE block_links (
  from_id VARCHAR(255) NOT NULL, -- Using VARCHAR based on Task 1.4 findings
  to_id VARCHAR(255) NOT NULL,   -- Using VARCHAR based on Task 1.4 findings
  relation VARCHAR(255) NOT NULL, -- Using VARCHAR based on Task 1.4 findings; Should use canonical types from MemoryBlock.links[].relation
  PRIMARY KEY (from_id, to_id, relation),
  FOREIGN KEY (from_id) REFERENCES memory_blocks(id) ON DELETE CASCADE,
  FOREIGN KEY (to_id) REFERENCES memory_blocks(id) ON DELETE CASCADE
);

-- Future considerations mentioned in project plan might add:
-- ALTER TABLE memory_blocks ADD COLUMN schema_version INT;
-- ALTER TABLE memory_blocks ADD COLUMN status VARCHAR(50); 